---
layout: post
title: การประมาณการคูณ
category: computer architecture
tags: [computer architecture]
---

การคูณนั้นเป็นสิ่งพื้นฐานที่เราใช้กันไม่ว่าจะเป็นในชีวิตประจำวัน

## ทำไมเราต้องการ การประมาณการคูณ
การคูณนั้นเป็นสิ่งพื้นฐานที่เราใช้กันไม่ว่าจะเป็นในชีวิตประจำวัน หรือให้คอมพิวเตอร์ใช้ ยกตัวอย่างง่ายเช่น การคูณกันของเมตริก นั้นมีการคูณแทรกอยู่ในระบบนั้นมากมาย ดังนั้นจึงมีแนวคิดว่า ถ้าเราทำให้การคูณที่มีอยู่นั้นดีขึ้น ในแง่ของการกินพลังงานน้อยลง เร็วขึ้น จะสามารถยกระดับความสามารถในหารแก้ปัญหาของคอมพิวเตอร์ได้ จากที่กล่าวมาข้างต้นนั้น เราจะบอกว่า การประมารการคูณ นั้นจะทำให้ประสิทธิภาพของตัวคูณนั้นดีขึ้น แลกกับการที่เราต้องมีความคลาดเคลื่อนในการคูณเกิดขึ้น  

## การประมาณการคูณนั้นเหมาะสมกับงานแบบไหน
เนื่องจากการประมาณการคูณนั้นสามารถทำให้ประสิทธิภาพของการคูณดีขึ้น แต่ก็แลกมากับความคลาดเคลื่อนของผลลัพธ์นั้น งานที่เหมาะสมเป็นงานที่ไม่จำเป็นต้องมีการคำนวณที่แม่นยำ เช่น งานทาง Machine Learning หรือ Deep Learning ที่เป็นการ classification ของข้อมูล หมายความอีกอย่างนึงคือ เราสามารถรู้ว่าข้อมูลนี้อยู่ในกลุ่มไหนโดยที่เราไม่ต้องคำนวณว่าจุดที่มันอยู่นั้น อยู่ที่ไหน 

งานที่เหมาะสมโดยหลักแล้วก็จะเป็น พวกตระกูลโครงข่ายปราสาทเทียม Artificial Neural Network โดยหลักการคำนวณของ ANN นั้นได้ค่าผลลัพธ์ออกมาตามจำนวนกลุ่มที่ต้องการแบ่ง แล้วดูว่ากลุ่มไหนนั้นมีค่ามากที่สุด เราก็เลือกว่าข้อมูลอันนี้อยู่ในกลุ่มนี้ ในอีกแง่คือ เราไม่ต้องการรู้ว่าค่ามากที่สุดคืออะไร แต่เราก็สามารถที่จะทำการทำนายผลลัพธ์ได้อย่างถูกต้อง

## ทำไมต้องเป็นการคูณ​
![image-title-here](/assets/image_post/20-12-2018/arxiv_ml.png){:class="img-responsive"}
ภาพข้่างบนนั้น เป็นกราฟแสดงจำนวนเปเปอร์ ในสาขา machine learning เราจะเห็นได้ว่างานในสาขานี้เติบโตอย่างเร็วมาก การที่จะสร้างระบบที่รองรับการคำนวณระดับนี้ได้นั้น จำเป็นต้องใช้พลังงานในการคำนวณอย่างมหาศาล จึงมีความจำเป็นต้องลดพลังงานลง จากการวิเคราะห์อัลกอรึทึมทางด้าน machine learning แล้วนั้นจะพบว่ามีการใช้ตัวคูณอยู่อย่างมหาศาลมาก จึงเกิดเป็นแนวคิดว่าถ้าเราพัฒนาตัวคูณที่มีอยู่ให้ดีขึ้น ทุกอย่างก็จะดีขึ้นตามไปด้วย  

## การคูณปกตินั้นทำยังไง 
![image-title-here](/assets/image_post/20-12-2018/mul_ar.png){:class="img-responsive"}
โดยปกติแล้วหากเรามีตัวบวกตัวเดียว แบบรูปข้างบน เราจะพิจารณาที่ตัวคูณ​ในเลขฐานสอง ถ้าตัวคูณที่เราพิจารณาอยู่นั้นเป็น 0 เราจะทำการเลื่อนบิทไปทางซ้าย 1 บิท แต่ถ้าเป็น 1 แล้วจะทำการบวกกับตัวตั้ง ทำไปจนกว่าจะครบจำนวนบิท ตัวอย่างจะอยู่ในตารางข้างล่าง
![image-title-here](/assets/image_post/20-12-2018/mul.png){:class="img-responsive"}
ในตัวอย่างนี้นั้นเป็นการเอา 38x20 หากเราพิจารณารอบแรกแล้วนั้นจะเห็นว่า เราจะไม่ทำการบวก จากนั้นเราจะทำการเลื่อนซ้านของตัวคูณ และเลื่อนขวาที่ตัวตั้ง แต่ในรอบที่ 3 เราจะเห็นว่าตัวสุดท้ายเป็น 1 เราจะทำการบวก ตัวตั้งกับตัวคูณเข้าด้วยกัน แล้วก็ทำไปเรื่อยจนหมดนั้นเอง 

## การประมาณการคูณนั้นทำยังไง 
เอาง่ายๆ เราจะกำหนดว่าเราจะบวกกี่รอบแล้วก็ทำไปเลย ยกตัวอย่างเช่นว่าเราจะทำการบวก 2 ครั้งในการคูณ เราจะพบว่าค่าที่ได้นั้นมีค่าใกล้เคียงกับค่าจริง ผลก็คือหากเรามีตัวบวกแค่ตัวเดียวนั้นจะทำให้ได้ผลลัพธ์เร็วขึ้น และใช้พลังงานลดลง 

การประมาณการคูณนั้นจะทำให้ระบบกินพลังงานน้อยลง และลดระยะเวลาทำให้ระบบนั้นเร็วขึ้น แต่การที่จะเอาไปใช้นั้นก็ต้องดูว่าเราจะเอาไปใช้กับงานอะไร จึงจะทำให้ดึงเอาศักยภาพของการประมาณนั้นออกมามากที่สุด การที่จะสร้างตัวคูณแบบนี้ได้นั้น เราต้องสร้างจากวงจรดิจิตอล ที่สามารถสร้างสถาปัตยกรรมคอมพิวเตอร์แบบเฉพาะได้ เช่น FPGA ซึ่งมีความท้าทายในการออกแบบและสร้างเป็นอย่างมาก 


### Reference
* [SiMul: An Algorithm-Driven Approximate Multiplier Design for Machine Learning](https://ieeexplore.ieee.org/abstract/document/8430625)
